{% extends 'base.html' %}

{% block content %}

    <div class="home-samples-box">
        <div class="home-samples-header" style="display: flex; align-items: center; padding-bottom: 10px;">
            <div class="flexbox">
              <h1 class="flexbox-item rightmost">Samples</h1>
              <form class="flexbox-item leftmost" action="{{ url_for('samples_list_base') }}" method="GET" style="margin-left: auto">
                <label>
                    <select name="sort" onchange="this.form.submit()">
                        <option value="latest" {% if request.args.get('sort') == 'latest' %}selected{% endif %}>
                            Latest
                        </option>
                        <option value="oldest" {% if request.args.get('sort') == 'oldest' %}selected{% endif %}>
                            Oldest
                        </option>
                        <option value="liked" {% if request.args.get('sort', 'liked') == 'liked' %}selected{% endif %}>
                            Most Liked
                        </option>
                    </select>
                </label>
              </form>
            </div>
        </div>

        <div class="home-samples-grid">
            {% for sample in samples %}
                <div class="home-sample">
                    <a href="../sample/{{ sample.id }}"><img
                            src="{{ url_for('static', filename='media/thumbs/' + sample.thumbnail_filename) }}"
                            alt="sample"></a>
                    <a href="../sample/{{ sample.id }}"><div>{{ sample.filename }}</div></a>
                    <p class="upload-date" data-utc="{{ sample.upload_date.isoformat() }}"
                       style="font-size: 14px;"></p>
                </div>
            {% endfor %}
        </div>
        <div class="flexbox">
            {% set no_seperator = (index + 2) >= page_num - 3 %}
            {% if no_seperator %}
            <span class="flexbox-item" style="margin-left: auto; margin-right: auto;">
            {% else %}
            <span class="flexbox-item" style="margin-left: auto;">
            {% endif %}
            {% set left_idx_num = 0 %}
            {% if (index - 2) >= 1 %}
            <a class="nav-btn" href="/samples/{{ index - 2 }}">{{ index - 2 }}</a> •
            {% set left_idx_num = left_idx_num + 1 %}
            {% endif %}
            {% if (index - 1) >= 1 %}
            <a class="nav-btn" href="/samples/{{ index - 1 }}">{{ index - 1 }}</a> •
            {% set left_idx_num = left_idx_num + 1 %}
            {% endif %}

            <a class="nav-btn" disabled>{{ index }}</a>

            {% if left_idx_num <= 3 %}
                {% if (index + 1) <= page_num %}
                • <a class="nav-btn" href="/samples/{{ index + 1 }}">{{ index + 1 }}</a>
                {% set left_idx_num = left_idx_num + 1 %}
                {% endif %}
            {% endif %}
            {% if left_idx_num <= 3 %}
                {% if (index + 2) <= page_num %}
                • <a class="nav-btn" href="/samples/{{ index + 2 }}">{{ index + 2 }}</a>
                {% set left_idx_num = left_idx_num + 1 %}
                {% endif %}
            {% endif %}

            {% if (index + 2) < page_num %}
            {% if no_seperator %}
             • 
            {% else %}
            </span>
            <span class="flexbox-item" style="">
              • • • 
            </span>
            <span class="flexbox-item" style="margin-right: auto;">
            {% endif %}

            {% if (index + 2) < page_num - 2 %}
            <a class="nav-btn" href="/samples/{{ page_num - 2 }}">{{ page_num - 2 }}</a> •
            {% endif %}
            {% if (index + 3) <= page_num - 1 %}
            <a class="nav-btn" href="/samples/{{ page_num - 1 }}">{{ page_num - 1 }}</a> •
            {% endif %}
            {% if index >= page_num %}
                <a class="nav-btn disabled">{{ page_num }}</a>
            {% else %}
                <a class="nav-btn" href="/samples/{{ page_num }}">{{ page_num }}</a>
            {% endif %}
            {% endif %}
            
            </span>
        </div>
    </div>

    <script>
        document.querySelectorAll('.upload-date').forEach(element => {
            const utcDate = element.getAttribute('data-utc');  // Get the date from data attribute
            const localTime = moment.utc(utcDate).local();  // Convert to local time
            element.innerText = localTime.fromNow();  // Set the relative time
        });
    </script>

{% endblock %}